[
  {
    "objectID": "mapa.html",
    "href": "mapa.html",
    "title": "Mapa de delitos",
    "section": "",
    "text": "library(tidyverse)\nlibrary(sf)\nlibrary(leaflet)\n\nY leyendo los datos, de la misma forma que en el diagrama de dispersión:\n\nbase_mapa <- read_rds(\"01_input/Mapa_scatter_delitos_prioritarios.rds\")\nEncoding(base_mapa$subtipo_de_delito) <- \"latin1\"\nEncoding(base_mapa$entidad) <- \"latin1\"\nhead(base_mapa)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfecha\nsubtipo_de_delito\nclave_ent\nentidad\nTotal\nCVEGEO\nNOMGEO\ngeometry\n\n\n\n\n2022-07-01\nRobo a casa habitación\n01\nAguascalientes\n164\n01\nAguascalientes\nMULTIPOLYGON (((-102.2879 2…\n\n\n2022-07-01\nRobo a casa habitación\n02\nBaja California\n294\n02\nBaja California\nMULTIPOLYGON (((-112.3007 2…\n\n\n2022-07-01\nRobo a casa habitación\n03\nBaja California Sur\n120\n03\nBaja California Sur\nMULTIPOLYGON (((-109.8945 2…\n\n\n2022-07-01\nRobo a casa habitación\n04\nCampeche\n120\n04\nCampeche\nMULTIPOLYGON (((-91.9565 20…\n\n\n2022-07-01\nRobo a casa habitación\n05\nCoahuila de Zaragoza\n140\n05\nCoahuila de Zaragoza\nMULTIPOLYGON (((-102.3108 2…\n\n\n2022-07-01\nRobo a casa habitación\n06\nColima\n123\n06\nColima\nMULTIPOLYGON (((-114.7373 1…\n\n\n\n\n\n\nUna vez más, tenemos que filtrar por tipo de delito y por fecha (recuerden que el tipo de delito lo va a determinar el usuario y la fecha la dejaremos fija)\n\nmapa_leaflet <- base_mapa %>% \n  filter(fecha==max(fecha)) %>% \n  filter(subtipo_de_delito==\"Homicidio doloso\")\nmapa_leaflet\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfecha\nsubtipo_de_delito\nclave_ent\nentidad\nTotal\nCVEGEO\nNOMGEO\ngeometry\n\n\n\n\n2022-08-01\nHomicidio doloso\n01\nAguascalientes\n11\n01\nAguascalientes\nMULTIPOLYGON (((-102.2879 2…\n\n\n2022-08-01\nHomicidio doloso\n02\nBaja California\n234\n02\nBaja California\nMULTIPOLYGON (((-112.3007 2…\n\n\n2022-08-01\nHomicidio doloso\n03\nBaja California Sur\n3\n03\nBaja California Sur\nMULTIPOLYGON (((-109.8945 2…\n\n\n2022-08-01\nHomicidio doloso\n04\nCampeche\n1\n04\nCampeche\nMULTIPOLYGON (((-91.9565 20…\n\n\n2022-08-01\nHomicidio doloso\n05\nCoahuila de Zaragoza\n6\n05\nCoahuila de Zaragoza\nMULTIPOLYGON (((-102.3108 2…\n\n\n2022-08-01\nHomicidio doloso\n06\nColima\n75\n06\nColima\nMULTIPOLYGON (((-114.7373 1…\n\n\n2022-08-01\nHomicidio doloso\n07\nChiapas\n32\n07\nChiapas\nMULTIPOLYGON (((-91.97364 1…\n\n\n2022-08-01\nHomicidio doloso\n08\nChihuahua\n202\n08\nChihuahua\nMULTIPOLYGON (((-107.6531 3…\n\n\n2022-08-01\nHomicidio doloso\n09\nCiudad de México\n79\n09\nCiudad de México\nMULTIPOLYGON (((-99.11124 1…\n\n\n2022-08-01\nHomicidio doloso\n10\nDurango\n14\n10\nDurango\nMULTIPOLYGON (((-105.9673 2…\n\n\n2022-08-01\nHomicidio doloso\n11\nGuanajuato\n251\n11\nGuanajuato\nMULTIPOLYGON (((-101.35 21….\n\n\n2022-08-01\nHomicidio doloso\n12\nGuerrero\n92\n12\nGuerrero\nMULTIPOLYGON (((-99.9061 16…\n\n\n2022-08-01\nHomicidio doloso\n13\nHidalgo\n17\n13\nHidalgo\nMULTIPOLYGON (((-98.48321 2…\n\n\n2022-08-01\nHomicidio doloso\n14\nJalisco\n175\n14\nJalisco\nMULTIPOLYGON (((-104.8145 1…\n\n\n2022-08-01\nHomicidio doloso\n15\nMéxico\n221\n15\nMéxico\nMULTIPOLYGON (((-99.91237 2…\n\n\n2022-08-01\nHomicidio doloso\n16\nMichoacán de Ocampo\n180\n16\nMichoacán de Ocampo\nMULTIPOLYGON (((-102.0101 2…\n\n\n2022-08-01\nHomicidio doloso\n17\nMorelos\n88\n17\nMorelos\nMULTIPOLYGON (((-99.06209 1…\n\n\n2022-08-01\nHomicidio doloso\n18\nNayarit\n9\n18\nNayarit\nMULTIPOLYGON (((-105.2742 2…\n\n\n2022-08-01\nHomicidio doloso\n19\nNuevo León\n155\n19\nNuevo León\nMULTIPOLYGON (((-100.0161 2…\n\n\n2022-08-01\nHomicidio doloso\n20\nOaxaca\n115\n20\nOaxaca\nMULTIPOLYGON (((-96.08409 1…\n\n\n2022-08-01\nHomicidio doloso\n21\nPuebla\n90\n21\nPuebla\nMULTIPOLYGON (((-97.84218 2…\n\n\n2022-08-01\nHomicidio doloso\n22\nQuerétaro\n11\n22\nQuerétaro\nMULTIPOLYGON (((-99.18811 2…\n\n\n2022-08-01\nHomicidio doloso\n23\nQuintana Roo\n55\n23\nQuintana Roo\nMULTIPOLYGON (((-87.38975 1…\n\n\n2022-08-01\nHomicidio doloso\n24\nSan Luis Potosí\n51\n24\nSan Luis Potosí\nMULTIPOLYGON (((-100.6035 2…\n\n\n2022-08-01\nHomicidio doloso\n25\nSinaloa\n33\n25\nSinaloa\nMULTIPOLYGON (((-106.4129 2…\n\n\n2022-08-01\nHomicidio doloso\n26\nSonora\n131\n26\nSonora\nMULTIPOLYGON (((-110.9509 2…\n\n\n2022-08-01\nHomicidio doloso\n27\nTabasco\n27\n27\nTabasco\nMULTIPOLYGON (((-92.45106 1…\n\n\n2022-08-01\nHomicidio doloso\n28\nTamaulipas\n51\n28\nTamaulipas\nMULTIPOLYGON (((-99.71772 2…\n\n\n2022-08-01\nHomicidio doloso\n29\nTlaxcala\n12\n29\nTlaxcala\nMULTIPOLYGON (((-98.05499 1…\n\n\n2022-08-01\nHomicidio doloso\n30\nVeracruz de Ignacio de la Llave\n98\n30\nVeracruz de Ignacio de la Llave\nMULTIPOLYGON (((-96.09229 1…\n\n\n2022-08-01\nHomicidio doloso\n31\nYucatán\n4\n31\nYucatán\nMULTIPOLYGON (((-92.2241 20…\n\n\n2022-08-01\nHomicidio doloso\n32\nZacatecas\n101\n32\nZacatecas\nMULTIPOLYGON (((-101.8488 2…\n\n\n\n\n\n\nAhora, para poder crear un mapa de coropletas, en el que los colores representen la cantidad de delitos, necesitamos una paleta de colores:\n\npal <- colorNumeric(\"inferno\",mapa_leaflet$Total,reverse = T,na.color = NA)\n\nYa con esto, crtear un mapa interactivo es muy fácil:\n\nleaflet() %>% \n  addProviderTiles(providers$OpenStreetMap) %>% \n  addPolygons(data=mapa_leaflet$geometry,\n              fillColor = pal(mapa_leaflet$Total),\n              color=\"black\",\n              weight = 1,\n              opacity = 1,\n              fillOpacity = .7,\n              label = mapa_leaflet$NOMGEO,\n              group = \"Entidades\")%>% \n  addLegend(pal = pal,values = mapa_leaflet$Total) %>% \n  addLayersControl(overlayGroups = \"Entidades\")"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Shiny en una sentada",
    "section": "",
    "text": "Introducción\nBienvenidos al tutorial para desarrollar un visualizador geográfico súper simple utilizando Shiny. Este taller fue desarrollado como parte de las actividades de la Semana de Divulgación de las Ciencias de Información Geoespacial 2022 de CentroGeo.\nShiny es una herramienta desarrollada por RStudio para crear de forma sencilla y usando únicamente el lenguaje de programación R. R provee paquetes de visualización y análisis estadístico muy poderosos, Shiny nos ayuda a usar las funcionalidades de R para construir tableros interactivos de visualización y análisis de forma rápida, sin recurrir directamente a tecnologías Web como Javascript o HTML.\nEl objetivo del taller es guiarte paso a paso en el desarrollo de un tablero de visualización muy simple que incluya un mapa y un par de graficos dinámicos. Vamos a trabajar cn datos del Secretariado Ejecutivo del Sistema Nacional de Seguridad Pública sobre incidencia delictiva en México. Para podr concentrarnos en este taller sólo en lo que tiene que ver con Shiny, vamos a usar una versión preprocesada de los datos abiertos.\n\n\nRequisitos previos\nAntes que nada, para seguir el taller es necesario que tengas una carpeta organizada de la siguiente forma:\nproyecto \n│   app.R    \n└───01_input\n│   │   Mapa_scatter_delitos_prioritarios.rds\n│   │   ts_delitos_prioritarios.rds\nLos datos los puedes bajar de aquí:\n\nMapa_scatter_delitos_prioritarios.rds\nts_delitos_prioritarios.rds\n\nAdemás tenemos que tener instalados, además de R (aquí encuentras las instrucciones para instalarlo), una serie de paquetes:\n\ninstall.packages(\"shiny\")\ninstall.packages(\"tidyverse\")\ninstall.packages(\"leaflet\")\n\n\n\nEstructura del taller\nUna ves que hemos cubierto los requisitos previos, podemos empezar a trabajar en nuestro visualizador. El taller está estructurado de la siguiente forma:\n\nEn la Sección Gráficas vamos a ver cómo se hacen individualmente los componentes de la aplicación:\n\nScatterplot\nSerie de tiempo\nMapa\n\nEn la sección Tablero, vamos a juntar estos elementos y programar la interactividad."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Acerca",
    "section": "",
    "text": "Noé Osorio García\nPablo López Ramírez"
  },
  {
    "objectID": "serie_tiempo.html",
    "href": "serie_tiempo.html",
    "title": "Serie de Tiempo",
    "section": "",
    "text": "Antes de empezar, cargamos los paquetes que vamos a usar:\n\nlibrary(tidyverse)\n\nLo primero que tenemos que hacer es leer los datos y fijar el encoding (para que funcionen bien los acentos).\n\nbase_ts <- read_rds(\"01_input/ts_delitos_prioritarios.rds\")\nEncoding(base_ts$subtipo_de_delito) <- \"latin1\"\nhead(base_ts)\n\n\n\n\n\nfecha\nsubtipo_de_delito\nTotal\n\n\n\n\n2015-01-01\nRobo a casa habitación\n7850\n\n\n2015-01-01\nRobo a negocio\n7352\n\n\n2015-01-01\nRobo a transeúnte\n6613\n\n\n2015-01-01\nRobo a transportista\n543\n\n\n2015-01-01\nRobo en transporte público colectivo\n1733\n\n\n2015-01-01\nRobo en transporte público individual\n140\n\n\n\n\n\n\nComo podemos ver, los datos son una serie de tiempo de los diferentes tipos de delitos en formato largo: la columna subtipo_de_delito discrimina los diferentes tipos de delito y la columna Total nos dice cuántos delitos hubo de ese tipo en cada periodo.\nPara poder aceptar el input del usuario y mostrar la serie de tiempo para el delito que seleccione, vamos anecesitar poder filtrar la serie por subtipo_de_delito:\n\nhead(base_ts %>% \n    filter(subtipo_de_delito == \"Homicidio doloso\"))\n\n\n\n\n\nfecha\nsubtipo_de_delito\nTotal\n\n\n\n\n2015-01-01\nHomicidio doloso\n1354\n\n\n2015-02-01\nHomicidio doloso\n1388\n\n\n2015-03-01\nHomicidio doloso\n1379\n\n\n2015-04-01\nHomicidio doloso\n1442\n\n\n2015-05-01\nHomicidio doloso\n1601\n\n\n2015-06-01\nHomicidio doloso\n1466\n\n\n\n\n\n\nYa con nuestro edlito de interés filtrado, podemos fácilmente hacer una gráfica de línea de la serie de tiempo:\n\nbase_ts %>%\n    filter(subtipo_de_delito == \"Homicidio doloso\") %>%\n    ggplot(aes(fecha, Total)) +\n        geom_line()\n\n\n\n\nMuy bien, ahora pongamos un punto rojo que nos indique el máximo de la serie de tiempo. Para esto lo primero que necesitamos es identificar la fecha en la que sucedió ese máximo.\n\nbase_ts %>% \n    filter(subtipo_de_delito == \"Homicidio doloso\") %>%\n    filter(Total == max(Total))\n\n\n\n\n\nfecha\nsubtipo_de_delito\nTotal\n\n\n\n\n2018-07-01\nHomicidio doloso\n3074\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nNoten cómo estamos aquí encadenando los dos filtros, uno sobre el tipo de delito y otro sobre el total.\n\n\nAhora podemos usar ese código para agregar un geom_point en el lugar donde ocurrió el máximo. El truco es poder pasar el filtro a geom_point que recibe automaticamente los datos completos (base_ts). Para eso podemos sobreescribir el parámetro data que recibe geom_point y usar la notación especial . para referirnos a lo que recibe originalmente.\n\nbase_ts %>%\n    filter(subtipo_de_delito == \"Homicidio doloso\") %>%\n    ggplot(aes(fecha, Total)) +\n    geom_line() + \n    geom_point(data=. %>% \n               filter(Total==max(Total)),\n               size=3,col=\"red\"\n    )\n\n\n\n\nAhora sólo nos falta poner otro punto en el último valor observado para permitir al usuario comparar fácilmente el valor actual con el valor máximo.\n\nbase_ts %>%\n    filter(subtipo_de_delito == \"Homicidio doloso\") %>%\n    ggplot(aes(fecha, Total)) +\n    geom_line() + \n    geom_point(data=. %>% \n               filter(Total==max(Total)),\n               size=3,col=\"red\"\n    ) +\n    geom_point(data=. %>% \n               filter(fecha==max(fecha)),\n               size=3,col=\"black\"\n    )    \n\n\n\n\nCon esto terminamos la primera de las gráficas que queremos desplegar. En la siguiente sección vamos a hacer un diagrama de dispersión."
  },
  {
    "objectID": "scatter_plot.html",
    "href": "scatter_plot.html",
    "title": "Diagrama de dispersión",
    "section": "",
    "text": "Una vez más, empezamos por cargar los paquetes que vamos a usar:\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(ggrepel)\n\nAhora podemos leer y explorar la base de donde vamos a sacar esta gráfica.\n\nbase_mapa <- read_rds(\"01_input/Mapa_scatter_delitos_prioritarios.rds\")\nEncoding(base_mapa$subtipo_de_delito) <- \"latin1\"\nEncoding(base_mapa$entidad) <- \"latin1\"\nhead(base_mapa)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfecha\nsubtipo_de_delito\nclave_ent\nentidad\nTotal\nCVEGEO\nNOMGEO\ngeometry\n\n\n\n\n2022-07-01\nRobo a casa habitación\n01\nAguascalientes\n164\n01\nAguascalientes\nMULTIPOLYGON (((-102.2879 2…\n\n\n2022-07-01\nRobo a casa habitación\n02\nBaja California\n294\n02\nBaja California\nMULTIPOLYGON (((-112.3007 2…\n\n\n2022-07-01\nRobo a casa habitación\n03\nBaja California Sur\n120\n03\nBaja California Sur\nMULTIPOLYGON (((-109.8945 2…\n\n\n2022-07-01\nRobo a casa habitación\n04\nCampeche\n120\n04\nCampeche\nMULTIPOLYGON (((-91.9565 20…\n\n\n2022-07-01\nRobo a casa habitación\n05\nCoahuila de Zaragoza\n140\n05\nCoahuila de Zaragoza\nMULTIPOLYGON (((-102.3108 2…\n\n\n2022-07-01\nRobo a casa habitación\n06\nColima\n123\n06\nColima\nMULTIPOLYGON (((-114.7373 1…\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\n¡Esta base de datos contiene geometrías! La columna geometry contiene las coordenadas del polígono de cada estado. En esta gráfica no las vamos a usar, pero más adelante sí, para hacer un mapa.\n\n\nEsta base es muy similar a la que usamos en la serie de tiempo, sólo que viene desagregada por entidad de la república, entonces tenemos una serie de tiempo para cada estado.\nEl diagrama de dispersión que vamos a hacer compara un mes con el mes anterior, para ayudar al usuario en la comparación, vamos a agregar una diagonal que representa el caso en el que no hubo cambios entre los meses. Para agregar esta diagonal, necesitamos calcular el máximo para el delito seleccionado por el usuario:\n\neje <- base_mapa %>% \n  filter(subtipo_de_delito==\"Homicidio doloso\") %>% \n  filter(Total==max(Total))\neje\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfecha\nsubtipo_de_delito\nclave_ent\nentidad\nTotal\nCVEGEO\nNOMGEO\ngeometry\n\n\n\n\n2022-07-01\nHomicidio doloso\n11\nGuanajuato\n298\n11\nGuanajuato\nMULTIPOLYGON (((-101.35 21….\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nEn una aplicación ideal, el usuario debería poder escoger las fechas que se usan para la comparación. Por las limitaciones de tiempo de este taller, vamos a fijar estas dos fechas.\n\n\nYa con este valor calculado, vamos primero a procesar los datos para hacer nuestra gráfica. Queremos, en lugar de la serie de tiempo, un DataFrame que tenga las entidades en las filas y dos columnas con los valores que corresponden a las fechas que queremos comparar. Para eso, lo que tenemos que hacer es pivotear las tablas y pasar las fechas (que están en renglones) a columnas:\n\nbase_mapa %>% \n  filter(subtipo_de_delito==\"Homicidio doloso\") %>%\n  st_drop_geometry() %>%\n  pivot_wider(id_cols = c('clave_ent','entidad'),\n              names_from = 'fecha',\n              values_from = 'Total')\n\n\n\n\n\nclave_ent\nentidad\n2022-07-01\n2022-08-01\n\n\n\n\n01\nAguascalientes\n7\n11\n\n\n02\nBaja California\n265\n234\n\n\n03\nBaja California Sur\n2\n3\n\n\n04\nCampeche\n9\n1\n\n\n05\nCoahuila de Zaragoza\n13\n6\n\n\n06\nColima\n57\n75\n\n\n07\nChiapas\n42\n32\n\n\n08\nChihuahua\n200\n202\n\n\n09\nCiudad de México\n67\n79\n\n\n10\nDurango\n11\n14\n\n\n11\nGuanajuato\n298\n251\n\n\n12\nGuerrero\n128\n92\n\n\n13\nHidalgo\n26\n17\n\n\n14\nJalisco\n193\n175\n\n\n15\nMéxico\n210\n221\n\n\n16\nMichoacán de Ocampo\n166\n180\n\n\n17\nMorelos\n99\n88\n\n\n18\nNayarit\n13\n9\n\n\n19\nNuevo León\n120\n155\n\n\n20\nOaxaca\n89\n115\n\n\n21\nPuebla\n82\n90\n\n\n22\nQuerétaro\n16\n11\n\n\n23\nQuintana Roo\n51\n55\n\n\n24\nSan Luis Potosí\n47\n51\n\n\n25\nSinaloa\n37\n33\n\n\n26\nSonora\n141\n131\n\n\n27\nTabasco\n29\n27\n\n\n28\nTamaulipas\n41\n51\n\n\n29\nTlaxcala\n9\n12\n\n\n30\nVeracruz de Ignacio de la Llave\n86\n98\n\n\n31\nYucatán\n4\n4\n\n\n32\nZacatecas\n123\n101\n\n\n\n\n\n\n\n\n\n\n\n\nWarning\n\n\n\nFíjense en la llamada a st_drop_geometry(). Esta función le quita la geometría a nuestros datos, de otra forma no podríamos pivotear la tabla\n\n\nAhora sí, ya con los datos bien acomodados, podemos hacer la gráfica que queremos:\n\nbase_mapa %>% \n  filter(subtipo_de_delito==\"Homicidio doloso\") %>%\n  st_drop_geometry() %>%\n  pivot_wider(id_cols = c('clave_ent','entidad'),\n              names_from = 'fecha',\n              values_from = 'Total')  %>%\n  ggplot(aes(`2022-07-01`,`2022-08-01`))+\n  geom_point()+\n  scale_y_continuous(limits = c(0,eje$Total))+\n  scale_x_continuous(limits = c(0,eje$Total))+\n  geom_abline()+\n  theme_classic()+\n  ggrepel::geom_text_repel(aes(label=entidad))      \n\nWarning: ggrepel: 10 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\nTodos los puntos que quedan por debajo de la diagonal nos indican una disminución en el último mes, mientras que por encima nos indican un aumento."
  }
]